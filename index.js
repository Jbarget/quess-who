const people = {
  'Adam Elmore': './images/Adam Elmore.jpg',
  'Adam Park': './images/Adam Park.jpg',
  'Alex Duncan': './images/Alex Duncan.jpg',
  'Alice Davies': './images/Alice Davies.jpg',
  'Andrew Harris': './images/Andrew Harris.jpg',
  'Andy Element': './images/Andy Element.jpg',
  'Anina Grostern': './images/Anina Grostern.jpg',
  'Anusha Amin': './images/Anusha Amin.jpg',
  'Asa Bradshaw': './images/Asa Bradshaw.jpg',
  'Bobbi Talbot': './images/Bobbi Talbot.jpg',
  'Bobby Steere': './images/Bobby Steere.jpg',
  'Brooke Berte': './images/Brooke Berte.jpg',
  'Callum Henderson': './images/Callum Henderson.jpg',
  'Callum Taylor': './images/Callum Taylor.jpg',
  'Cameron Stokes': './images/Cameron Stokes.jpg',
  'Catherine Handley': './images/Catherine Handley.jpg',
  'Cecily Melsom': './images/Cecily Melsom.jpg',
  'Charlie Colwill': './images/Charlie Colwill.jpg',
  'Charlie Greene': './images/Charlie Greene.jpg',
  'Charlotte Emmersom': './images/Charlotte Emmersom.jpg',
  'Charly Nelson': './images/Charly Nelson.jpg',
  'Chris Priestly': './images/Chris Priestly.jpg',
  'Christian Smith': './images/Christian Smith.jpg',
  'Daisy Eakins': './images/Daisy Eakins.jpg',
  'Dan Gillespie': './images/Dan Gillespie.jpg',
  'Dayo Kamson': './images/Dayo Kamson.jpg',
  'Dylan Davenport': './images/Dylan Davenport.jpg',
  'Ed Burgess': './images/Ed Burgess.jpg',
  'Eithne Bryan': './images/Eithne Bryan.jpg',
  'Elliot Meller': './images/Elliot Meller.jpg',
  'Elliya Cleveley': './images/Elliya Cleveley.jpg',
  'Emily Barrett': './images/Emily Barrett.jpg',
  'Emily Habin': './images/Emily Habin.jpg',
  'Emma Baggott': './images/Emma Baggott.jpg',
  'Emma Brazell': './images/Emma Brazell.jpg',
  'Emma Davis': './images/Emma Davis.jpg',
  'Emma Engelmann': './images/Emma Engelmann.jpg',
  'Emma Guiness': './images/Emma Guiness.jpg',
  'Eric Koeppel': './images/Eric Koeppel.jpg',
  'Florence Beasley': './images/Florence Beasley.jpg',
  'George MacDonald': './images/George MacDonald.jpg',
  'George Pratt': './images/George Pratt.jpg',
  'Gigi Wolujewicz': './images/Gigi Wolujewicz.jpg',
  'Grace Potton': './images/Grace Potton.jpg',
  'Greg Wickert': './images/Greg Wickert.jpg',
  'Hannah Hawkins': './images/Hannah Hawkins.jpg',
  'Hannah Watson': './images/Hannah Watson.jpg',
  'Hannah Williamst': './images/Hannah Williams.jpg',
  'Harry Bamber': './images/Harry Bamber.jpg',
  'Holly Tillbrook': './images/Holly Tillbrook.jpg',
  'Hugh Woodward': './images/Hugh Woodward.jpg',
  'Jack Godwin': './images/Jack Godwin.jpg',
  'Jack Jeffery': './images/Jack Jeffery.jpg',
  'James Evans': './images/James Evans.jpg',
  'James McCaughley': './images/James McCaughley.jpg',
  'Jamie Bolding': './images/Jamie Bolding.jpg',
  'Jamie Slough': './images/Jamie Slough.jpg',
  'Jesmira Bonoan': './images/Jesmira Bonoan.jpg',
  'Jessica Gray': './images/Jessica Gray.jpg',
  'Jodie Masser': './images/Jodie Masser.jpg',
  'Joe Lewis': './images/Joe Lewis.jpg',
  'Joe Terzeon': './images/Joe Terzeon.jpg',
  'Jonathan Kitchen': './images/Jonathan Kitchen.jpg',
  'Jordan Harvey': './images/Jordan Harvey.jpg',
  'Jordan Paterson': './images/Jordan Paterson.jpg',
  'Josh Kalms': './images/Josh Kalms.jpg',
  'Kelsie Leonard': './images/Kelsie Leonard.jpg',
  'Kim Holman': './images/Kim Holman.jpg',
  'Laura Hutchinson': './images/Laura Hutchinson.jpg',
  'Laura Smith': './images/Laura Smith.jpg',
  'Laura Woodley': './images/Laura Woodley.jpg',
  'Lauren Edwards': './images/Lauren Edwards.jpg',
  'Lauren Kirkland': './images/Lauren Kirkland.jpg',
  'Lewis Potton': './images/Lewis Potton.jpg',
  'Liam Bedford': './images/Liam Bedford.jpg',
  'Liam Chambers': './images/Liam Chambers.jpg',
  'Lois Bellamy': './images/Lois Bellamy.jpg',
  'Luke Hopkins': './images/Luke Hopkins.jpg',
  'Marcus Gibson-Blair': './images/Marcus Gibson-Blair.jpg',
  'Marcus Wilson': './images/Marcus Wilson.jpg',
  'Marissa Giannone': './images/Marissa Giannone.jpg',
  'Mark Spencer': './images/Mark Spencer.jpg',
  'Matt Boner': './images/Matt Boner.jpg',
  'Matt Hucks': './images/Matt Hucks.jpg',
  'Melissa Chapman': './images/Melissa Chapman.jpg',
  'Michelle Hambiliki': './images/Michelle Hambiliki.jpg',
  'Mitch Strong': './images/Mitch Strong.jpg',
  'Mitchell Armstrong': './images/Mitchell Armstrong.jpg',
  'Molly Tappin': './images/Molly Tappin.jpg',
  'Nadia Rahman': './images/Nadia Rahman.jpg',
  'Nat Poulter': './images/Nat Poulter.jpg',
  'Nathan Grace': './images/Nathan Grace.jpg',
  'Nessa Humayun': './images/Nessa Humayun.jpg',
  'Nina Edelshain': './images/Nina Edelshain.jpg',
  'Oisin Bickley': './images/Oisin Bickley.jpg',
  'Oli Warley': './images/Oli Warley.jpg',
  'Oliver Ingham': './images/Oliver Ingham.jpg',
  'Olivia DiTomaso': './images/Olivia DiTomaso.jpg',
  'Olivia Podmore': './images/Olivia Podmore.jpg',
  'Olivia Seaman': './images/Olivia Seaman.jpg',
  'Olly Underwood': './images/Olly Underwood.jpg',
  'Paul Beiboer': './images/Paul Beiboer.jpg',
  'Polly Watson': './images/Polly Watson.jpg',
  'Rachael Edwards': './images/Rachael Edwards.jpg',
  'Richard Jones': './images/Richard Jones.jpg',
  'Rob Katz': './images/Rob Katz.jpg',
  'Rob Warren': './images/Rob Warren.jpg',
  'Rory Metcalfe': './images/Rory Metcalfe.jpg',
  'Rosie Box': './images/Rosie Box.jpg',
  'Rosie Day': './images/Rosie Day.jpg',
  'Ross Yellowless': './images/Ross Yellowless.jpg',
  'Rozie Powell': './images/Rozie Powell.jpg',
  'Sami Russell-Stracey': './images/Sami Russell-Stracey.jpg',
  'Sarah Gyasi': './images/Sarah Gyasi.jpg',
  'Sarah Peters': './images/Sarah Peters.jpg',
  'Sarah Ricketts': './images/Sarah Ricketts.jpg',
  'Siobhan Carty': './images/Siobhan Carty.jpg',
  'Siobhan McDade': './images/Siobhan McDade.jpg',
  'Sis Gurdal': './images/Sis Gurdal.jpg',
  'Sophie Wyburd': './images/Sophie Wyburd.jpg',
  'Stefan Armitage': './images/Stefan Armitage.jpg',
  'Tanner Kelly': './images/Tanner Kelly.jpg',
  'Tara Maini': './images/Tara Maini.jpg',
  'Tawfiq Oladoja': './images/Tawfiq Oladoja.jpg',
  'Thomas Lethbridge': './images/Thomas Lethbridge.jpg',
  'Tom Jackson': './images/Tom Jackson.jpg',
  'Tom McGirr': './images/Tom McGirr.jpg',
  'Tyrone Brown': './images/Tyrone Brown.jpg',
  'Will Hamnett': './images/Will Hamnett.jpg',
  'William Turner': './images/William Turner.jpg',
  'Yasmin Harding': './images/Yasmin Harding.jpg'
}

const getInitialState = (gameNames, numberOfRounds) => {
  const shuffledRounds = shuffleArray(gameNames)
  return {
    correct: [],
    incorrect: [],
    roundNumber: -1,
    rounds: numberOfRounds === 'max' ? shuffledRounds : shuffledRounds.slice(0, numberOfRounds)
  }
}

const setNumberOfRounds = (event) => {
  const numberOfRounds = event.target.id
  document.getElementById('header').classList.add(numberOfRounds)
  startGame(numberOfRounds, getInitialState)
}

const showScreen = (screenId) => {
  const screenIds = ['home-screen', 'game-screen', 'end-screen']
  document.getElementById(screenId).classList.remove('hide')

  screenIds
    .filter(screen => screen !== screenId)
    .forEach(screenId => document.getElementById(screenId).classList.add('hide'))
}

const resetAnswerClasses = () => {
  const nameButtons = document.querySelectorAll('.userName')
  nameButtons.forEach(button => {
    button.classList.remove('correctAnswer')
    button.classList.remove('incorrectAnswer')
  })
}

const handleQuitClick = (roundHandler, advanceRound) => () => {
  showScreen('home-screen')
  const nameButtons = document.querySelectorAll('.userName')
  nameButtons.forEach((button) => {
    button.removeEventListener('click', roundHandler)
  })
  document.getElementById('next-button').removeEventListener('click', advanceRound)
}

const shuffleArray = (array) => {
  var currentIndex = array.length
  var temporaryValue
  var randomIndex

  // While there remain elements to shuffle...
  while (currentIndex !== 0) {
    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex)
    currentIndex -= 1

    // And swap it with the current element.
    temporaryValue = array[currentIndex]
    array[currentIndex] = array[randomIndex]
    array[randomIndex] = temporaryValue
  }

  return array
}

const init = () => {
  document.querySelectorAll('.roundButton')
    .forEach(button => button.addEventListener('click', setNumberOfRounds))
}

const names = Object.keys(people)
const numberOfNames = names.length

const checkIndex = (indexToAvoid, randomIndexArray, generateIndex) => {
  const index = generateIndex()
  if (index === indexToAvoid || randomIndexArray.includes(index)) {
    return checkIndex(indexToAvoid, randomIndexArray, generateIndex)
  }
  return index
}

const generateRandomIndexArray = (indexToAvoid) => {
  let randomIndexArray = []
  const generateIndex = () => Math.floor(Math.random() * numberOfNames)
  while (randomIndexArray.length < 3) {
    const index = checkIndex(indexToAvoid, randomIndexArray, generateIndex)
    randomIndexArray.push(index)
  }

  return randomIndexArray
}

const gameNames = names.map((name, i) => {
  return {
    realName: name,
    image: people[name],
    names: generateRandomIndexArray(i).map(index => names[index])
  }
})

const newRound = (rounds, getRoundNumber) => {
  const roundNumber = getRoundNumber()
  const currentRound = rounds[roundNumber]
  const namesToPlay = shuffleArray(currentRound.names.concat([currentRound.realName]))
  const nameButtons = document.querySelectorAll('.userName')

  document.getElementById('next-button').classList.add('hide')
  document.getElementById('current-round').textContent = roundNumber + 1
  nameButtons.forEach((button, i) => {
    button.textContent = namesToPlay[i]
    button.disabled = false
  })
  document.getElementById('user-image').src = currentRound.image
}

const handleNameClick = ({ rounds, addCorrect, addIncorrect, getRoundNumber, getIsLastRound }) => (event) => {
  const roundNumber = getRoundNumber()
  const round = rounds[roundNumber]
  const isLastRound = getIsLastRound()
  const arrayOfNameButtons = Array.from(document.getElementsByClassName('userName'))
  const nextButton = document.getElementById('next-button')

  nextButton.classList.remove('hide')
  if (isLastRound) {
    nextButton.textContent = 'Finish'
  }

  arrayOfNameButtons.forEach((button) => button.disabled = true)
  if (event.target.textContent === round.realName) {
    event.target.classList.add('correctAnswer')
    addCorrect()
    return
  }
  event.target.classList.add('incorrectAnswer')
  arrayOfNameButtons
    .find((button) => button.textContent === rounds[roundNumber].realName)
    .classList
    .add('correctAnswer')
  return addIncorrect()
}

const handleNextClick = ({ rounds, getRoundNumber, incRoundNumber, getIsLastRound, getIncorrect }) => () => {
  const isLastRound = getIsLastRound()
  incRoundNumber()
  resetAnswerClasses()

  if (isLastRound) {
    const incorrect = getIncorrect()
    const incorrectAnswersList = document.getElementById('incorrect-answers')
    while (incorrectAnswersList.firstChild) {
      incorrectAnswersList.removeChild(incorrectAnswersList.firstChild)
    }
    fastdom.mutate(() => {
      incorrect.forEach(incorrectAnswer => {
        const node = document.createElement('LI')
        const imgNode = document.createElement('IMG')
        const span = document.createElement('SPAN')
        const textNode = document.createTextNode(incorrectAnswer.realName)
        imgNode.src = incorrectAnswer.image
        imgNode.class = 'incorrectAnswerImg'
        textNode.class = 'incorrectAnswerName'

        node.appendChild(imgNode)
        span.appendChild(textNode)
        node.appendChild(span)
        incorrectAnswersList.appendChild(node)
      })
      document.getElementById('score').textContent = rounds.length - incorrect.length
    })
    return showScreen('end-screen')
  }
  newRound(rounds, getRoundNumber)
}

const startGame = (numberOfRoundsString, getInitialState) => {
  let { correct, incorrect, roundNumber, rounds } = getInitialState(gameNames, numberOfRoundsString)
  const numberOfRounds = rounds.length
  const addCorrect = () => correct = correct.concat([rounds[roundNumber]])
  const addIncorrect = () => incorrect = incorrect.concat([rounds[roundNumber]])
  const getRoundNumber = () => roundNumber
  const getIncorrect = () => incorrect
  const incRoundNumber = () => roundNumber++
  const getIsLastRound = () => roundNumber === numberOfRounds - 1

  const roundHandler = handleNameClick({ rounds, addCorrect, addIncorrect, getRoundNumber, getIsLastRound })
  const advanceRound = handleNextClick({ rounds, getRoundNumber, incRoundNumber, getIsLastRound, getIncorrect })
  const nameButtons = document.querySelectorAll('.userName')

  nameButtons.forEach((button) => {
    button.addEventListener('click', roundHandler)
  })
  document.getElementById('total-score').textContent = numberOfRounds
  document.getElementById('total-rounds').textContent = numberOfRounds
  document.getElementById('next-button').addEventListener('click', advanceRound)
  document.getElementById('quit-button').addEventListener('click', handleQuitClick(roundHandler, advanceRound))
  document.getElementById('restart-button').addEventListener('click', handleQuitClick(roundHandler, advanceRound))
  document.getElementById('next-button').textContent = 'Next'

  advanceRound(rounds, roundNumber)
  showScreen('game-screen')
}

init()
